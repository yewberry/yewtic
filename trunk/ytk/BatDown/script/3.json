{
	"id": 3,
	"title": "欧美主流",
	"url": "http://bbs.breezecn.com/thread.php?fid=3",
	"steps": {
		"seq": ["login_check",
		"login",
		"wait_redirect",
		"get_post",
		"get_music",
		"get_url"],
		"get_post": {
			"test": "",
			"script": "yewtic.logInfo('获取帖子列表...');\nvar posts = $('tr.tr3,tr.t_one');\nyewtic.logInfo('疑似发现 '+posts.length+' 个帖子。');\nvar arr = [];\nvar len = posts.length-1;\/\/skip the last post by 赞助网站\nfor (var i=0; i<len; i++){\n\tvar tds = $('td', posts[i]);\n\tif(tds.length != 6){\n\t\tcontinue;\n\t}\n\tvar o = {};\n\t\/\/o.idx = i;\n\tvar h = tds[0];\n\tvar post = tds[1];\n\tvar post_cata = $('a', post)[0];\n\tif (post_cata != null){\n\t\tvar t = post_cata.innerHTML;\n\t\tif (t.indexOf('[')!=0 || t=='[公告]' || t==\"[其他]\"){\n\t\t\tcontinue;\n\t\t}\n\t\tif (post_cata.childNodes.length == 3){\n\t\t\to.cata = post_cata.childNodes[1].innerHTML;\n\t\t} else {\n\t\t\to.cata = jQuery.trim( t.substring(1, t.length-1) );\n\t\t}\n\t}\n\tvar postLink = $('H3', post)[0];\n\to.url = $('a', postLink)[0].href;\n\to.title = jQuery.trim( postLink.textContent );\n\to.rank = jQuery.trim( postLink.nextSibling.nodeValue);\n\tif (o.rank.indexOf('(')!=0){\n\t\to.rank = '0';\n\t} else {\n\t\to.rank = jQuery.trim(o.rank.substring(1, o.rank.length-1));\n\t}\n\to.post_by = jQuery.trim( $('a',tds[2])[0].innerHTML );\n\to.post_dt = jQuery.trim( $('div',tds[2])[0].innerHTML );\n\to.reply_num = jQuery.trim( tds[3].firstChild.nodeValue );\n\to.view_num = jQuery.trim( tds[4].firstChild.nodeValue );\n\to.last_reply_dt = jQuery.trim( $('a',tds[5])[0].innerHTML );\n\tarr.push(o);\n}\nyewtic.logInfo('提取 ' + arr.length + ' 个帖子。');\nvar s = $.toJSON(arr);\nyewtic.procPostLists(s);\nyewtic.setProperty('nextStep', 'get_music');\n"
		},
		"login": {
			"test": "",
			"script": "yewtic.logInfo('登录...');\nvar usr = $('input[name=\"pwuser\"]')[0];\nvar pwd = $('input[name=\"pwpwd\"]')[0];\nvar sub = $('input[type=\"submit\"]')[0];\nusr.value = 'yew98';\npwd.value = 'yewyew';\nyewtic.setProperty('nextStep', 'wait_redirect');\nyewtic.logInfo('等待跳转...');\nsub.click();\n"
		},
		"login_check": {
			"test": "if ($('a[href=\"login.php\"]').length == 1){\n\tyewtic.setProperty('_test_hit', 'TRUE');\n}\n",
			"script": "for (var i=0; i<1000000; i++){var a = 0;}\nyewtic.logInfo('检查是否登录...');\nvar a = $('a[href=\"login.php\"]');\nif (a.length == 1){\n\tyewtic.logInfo('尚未登录');\n\tyewtic.setProperty('nextStep', 'login');\n\tparent.location = a[0].href;\n} else {\n\tyewtic.logInfo('已登录');\n\tyewtic.setProperty('nextStep', 'get_post');\n\tparent.location.reload() \n}\n"
		},
		"wait_redirect": {
			"test": "",
			"script": "yewtic.setProperty('nextStep', 'get_post');\n"
		}
	}
}